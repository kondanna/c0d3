<div id="$root"></div>

<script type="text/babel">

    const TodoItem = ({ id, text, prev, next, addTodo, deleteTodo }) => { 
        const itemStyle = { width: '100%', textAlign: 'justify', margin: '10px 0', cursor: 'crosshair' }
        const arrowStyle = { display: 'inline-block', cursor: 'pointer', alignSelf: 'center', margin: '10px' }

        return (
            <div style={{display: 'flex', justifyContent: 'stretch', margin: '5px', width: '100%'}}>
                {prev && <div onClick={() => {
                    deleteTodo(id)
                    addTodo(text, prev)
                }} style={arrowStyle}>{'<'}</div>}

                <div onClick={() => deleteTodo(id)} style={itemStyle}>{text}</div>

                {next && <div onClick={() => {
                    deleteTodo(id)
                    addTodo(text, next)
                }} style={arrowStyle}>{'>'}</div>}
            </div>
        )
    }

    const TodoList = ({ name, style, kanban, setKanban, prev, next }) => {
        const [todoValue, setTodoValue] = React.useState('')

        React.useEffect(() => {
            console.log(kanban)
            localStorage.setItem('kanban', JSON.stringify(kanban))
        }, [kanban])

        const addTodo = (text, list) => { 
            setKanban([...kanban, { id: Date.now(), list, text }])
        }

        const deleteTodo = todoId => {
            setKanban(kanban.filter(todoItem => todoItem.id !== todoId))
        }

        const todoItems = kanban.map(({list, text, id}, i) => {
            if (list === name) {
                return <TodoItem key={i} id={id} name={name} text={text} prev={prev} next={next} addTodo={addTodo} deleteTodo={deleteTodo}/>
            }
        })

        const todoListContainerStyle = { display: 'flex', flexDirection: 'column', margin: '30px', height: '100%' }
        const titleContainerStyle = {...style, color: 'white', width: '100%', textAlign: 'center'}
        const inputContainerStyle =  { display: 'flex', width: '100%' }

        return (
            <div id={name} style={todoListContainerStyle}>
                <div style={titleContainerStyle}>
                        <div className={'title'}>{name}</div>
                </div>
                
                <div className={'todoItems'}>{todoItems}</div>

                <div style={inputContainerStyle}>
                        <textarea value={todoValue} onChange={e => setTodoValue(e.target.value)} style={{width: '100%'}}></textarea>
                        <button onClick={() => {
                            addTodo(todoValue, name)
                            setTodoValue('')
                        }}>Submit</button>
                </div>
            </div>
        )
    }

    const Kanban = () => {
        const [kanban, setKanban] = React.useState([]) // [{list: 'doing', text: 'something', <id>}, etc.]

        React.useEffect(() => {
            setKanban(JSON.parse(localStorage.getItem('kanban')) || [])
        }, [])

        const kanbanStructure = [
            { name: 'todo', style: { backgroundColor:'#35235D' }, prev: '', next: 'doing' },
            { name: 'doing', style: { backgroundColor:'#CB2402' }, prev: 'todo', next: 'done' },
            { name: 'done', style: { backgroundColor:'#4C49A2' }, prev: 'doing', next: 'approved' },
            { name: 'approved', style: { backgroundColor:'#A31A48' }, prev: 'done', next: '' }
        ]

        return (
            <div style={{display: 'flex', margin: '30px'}}>
                { 
                    kanbanStructure.map(({ name, style, prev, next}, i) => {
                        return <TodoList key={i} name={name} style={style} kanban={kanban} setKanban={setKanban} prev={prev} next={next} />       
                    })
                }
            </div>
        )
    }

    const Stars = () => {
        const [selection, setSelection] = React.useState(0)
        const [tense, setTense] = React.useState('are selecting')

        const stars = [1,2,3,4,5].map(starIdx => {
            return (
                <i
                    key={starIdx}
                    style={{ color: 'yellow', fontSize: '30px', cursor: 'pointer' }}
                    className={selection >= starIdx ? 'fa-star fas' : 'fa-star far'}
                    onMouseEnter={() => {
                        setTense('are selecting')
                        setSelection(starIdx) 
                    }}
                    onClick={() => setTense('have selected')}>
                </i>
            )
        })

        return (
            <div>
                {stars}
                <div>You {tense} {selection} stars!</div>
            </div>
        )
    }

    const App = () => {
        const app = window.location.pathname.split('/').pop()
        console.log(app)
        if (app.toLowerCase() === 'stars') return <Stars />
        return <Kanban />
    }

    ReactDOM.render(<App />, $root)

</script>
<script crossorigin src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>